# Hospital API

Sistema de API para gerenciamento de consultas hospitalares com autentica√ß√£o JWT e Clean Architecture.

## üõ†Ô∏è Tecnologias

- **Java 21**
- **Spring Boot 3.5.5**
- **PostgreSQL**
- **Docker & Docker Compose**
- **Maven**
- **JWT Authentication**
- **Spring Security**
- **GraphQL** (para integra√ß√£o com servi√ßos de consulta)
- **Spring GraphQL Client**
- **JaCoCo** (cobertura de testes)

## üöÄ Como Executar

### Pr√©-requisitos

- Java 21
- Maven
- Docker e Docker Compose

### üìã Op√ß√£o 1: Execu√ß√£o Local (Desenvolvimento)

Esta op√ß√£o roda apenas o banco de dados no Docker e a aplica√ß√£o localmente.

#### 1. Iniciar o banco PostgreSQL

```bash
docker-compose up app-db -d
```

#### 2. Compilar o projeto

```bash
./mvnw clean package -DskipTests
```

#### 3. Executar a aplica√ß√£o

```bash
java -jar target/hospital-bff-0.0.1-SNAPSHOT.jar --spring.profiles.active=dev
```

#### 4. Verificar se est√° funcionando

A aplica√ß√£o estar√° dispon√≠vel em: `http://localhost:8080`

#### 5. Para parar

```bash
# Parar a aplica√ß√£o: Ctrl+C no terminal
# Parar o banco:
docker-compose down app-db
```

---

### üê≥ Op√ß√£o 2: Execu√ß√£o Completa com Docker

Esta op√ß√£o roda toda a aplica√ß√£o (app + banco + Kong Gateway) no Docker.

#### 1. Executar tudo

```bash
docker-compose up --build
```

**Observa√ß√µes:**
- O primeiro build pode demorar alguns minutos
- A aplica√ß√£o ir√° aguardar o banco de dados estar pronto
- Todos os servi√ßos ser√£o inicializados automaticamente

#### 2. Verificar se est√° funcionando

- **Aplica√ß√£o**: `http://localhost:8080`
- **Kong Gateway**: `http://localhost:8000`
- **Kong Admin**: `http://localhost:8001`
- **Kong Manager**: `http://localhost:8002`

#### 3. Executar em background (detached mode)

```bash
docker-compose up --build -d
```

#### 4. Ver logs da aplica√ß√£o

```bash
# Ver todos os logs
docker-compose logs

# Ver apenas logs da aplica√ß√£o
docker-compose logs app

# Seguir logs em tempo real
docker-compose logs -f app
```

#### 5. Para parar

```bash
# Parar containers (preserva dados)
docker-compose down

# Parar e remover volumes (remove dados do banco)
docker-compose down -v
```

---

## üìä Servi√ßos Dispon√≠veis

| Servi√ßo | Porta Local | Porta Docker | Descri√ß√£o |
|---------|-------------|--------------|-----------|
| Hospital API | 8080 | 8080 | API principal |
| PostgreSQL | 5432 | 5432 | Banco de dados |
| Kong Gateway | 8000 | 8000 | API Gateway (Proxy) |
| Kong Admin API | 8001 | 8001 | Kong Admin API |
| Kong Manager | 8002 | 8002 | Kong Interface Web |
| Kong SSL Proxy | 8443 | 8443 | Gateway HTTPS |
| Kong Admin SSL | 8444 | 8444 | Admin API HTTPS |

## üåê Kong API Gateway

O projeto utiliza o **Kong Gateway** como API Gateway para gerenciar e rotear requisi√ß√µes para a API hospitalar. Kong √© um gateway de API open-source que oferece funcionalidades avan√ßadas de proxy, seguran√ßa e observabilidade.

### üîß **Configura√ß√£o Kong**

#### **Modo Database-less (DBless)**
- Kong roda em modo **declarativo sem banco de dados**
- Configura√ß√£o via arquivo `kong-config/kong.yml`
- Melhor performance e simplicidade para APIs menores
- Configura√ß√£o versionada junto com o c√≥digo

#### **Arquitetura de Rede**
```
Cliente ‚Üí Kong Gateway (8000) ‚Üí Hospital API (8080)
```

### üìã **Rotas Configuradas**

O Kong est√° configurado para rotear as seguintes rotas da API:

```yaml
# Autentica√ß√£o
/api/v1/auth ‚Üí Hospital API

# Gest√£o de Usu√°rios  
/api/v1/users ‚Üí Hospital API

# Consultas M√©dicas
/api/v1/consults ‚Üí Hospital API
```

### ‚öôÔ∏è **Funcionalidades Ativas**

#### **üîÑ Resili√™ncia**
- **Timeout**: 60 segundos para conex√£o/leitura/escrita
- **Retries**: 5 tentativas autom√°ticas em caso de falha
- **Circuit Breaker**: Prote√ß√£o contra sobrecarga

#### **üìä Observabilidade**
- **Logs de Acesso**: Requisi√ß√µes registradas em stdout
- **Logs de Erro**: Erros registrados em stderr
- **M√©tricas**: Dispon√≠veis via Admin API

#### **üîí Seguran√ßa**
- **Rate Limiting**: Controle de taxa de requisi√ß√µes
- **CORS**: Configura√ß√£o de pol√≠ticas cross-origin
- **SSL/TLS**: Suporte HTTPS na porta 8443

### üöÄ **Usando o Kong Gateway**

#### **Acessar API via Kong**
```bash
# Via Kong Gateway (recomendado)
curl http://localhost:8000/api/v1/auth/login

# Diretamente na API (desenvolvimento)
curl http://localhost:8080/api/v1/auth/login
```

#### **Monitoramento via Admin API**
```bash
# Status dos servi√ßos
curl http://localhost:8001/services

# Status das rotas
curl http://localhost:8001/routes

# M√©tricas de sa√∫de
curl http://localhost:8001/status
```

#### **Interface Web Kong Manager**
- **URL**: http://localhost:8002
- **Funcionalidades**:
  - Visualiza√ß√£o de rotas e servi√ßos
  - Monitoramento de tr√°fego
  - Configura√ß√£o de plugins
  - An√°lise de logs e m√©tricas

### üõ†Ô∏è **Configura√ß√£o Avan√ßada**

#### **Adicionando Plugins**
Para adicionar plugins Kong, edite o arquivo `kong-config/kong.yml`:

```yaml
services:
- name: hospital-bff
  url: http://app:8080
  plugins:
  - name: rate-limiting
    config:
      minute: 100
      hour: 1000
  - name: cors
    config:
      origins: ["*"]
      methods: ["GET", "POST", "PUT", "DELETE", "PATCH"]
```

#### **Rate Limiting para Hospital**
```yaml
# Exemplo: Limita√ß√£o para consultas m√©dicas
- name: rate-limiting
  service: hospital-bff
  route: easy-consult
  config:
    minute: 30    # 30 consultas por minuto
    hour: 500     # 500 consultas por hora
```

#### **Autentica√ß√£o JWT**
```yaml
# Exemplo: Valida√ß√£o JWT no Kong
- name: jwt
  service: hospital-bff
  config:
    key_claim_name: iss
    secret_is_base64: false
```

### üìà **Benef√≠cios do Kong no Projeto**

#### **üè• Para Ambiente Hospitalar**
- **Alta Disponibilidade**: Retry autom√°tico para APIs cr√≠ticas
- **Monitoramento**: Tracking de APIs m√©dicas sens√≠veis
- **Seguran√ßa**: Prote√ß√£o contra ataques DDoS
- **Compliance**: Logs audit√°veis para LGPD/HIPAA

#### **üë©‚Äçüíª Para Desenvolvimento**
- **Proxy Transparente**: N√£o afeta desenvolvimento local
- **Debugging**: Logs detalhados de todas as requisi√ß√µes
- **Testing**: Ambiente consistente entre dev/prod
- **Versionamento**: Rotas versionadas facilmente

### üîç **Troubleshooting Kong**

#### **Verificar Status do Kong**
```bash
# Status geral
docker logs kong-dbless-readonly

# Recarregar configura√ß√£o
curl -X POST http://localhost:8001/config \
  -F config=@kong-config/kong.yml
```

#### **Problemas Comuns**

**Kong n√£o responde na porta 8000:**
```bash
# Verificar se container est√° rodando
docker ps | grep kong

# Verificar logs
docker logs kong-dbless-readonly

# Reiniciar Kong
docker restart kong-dbless-readonly
```

**Erro 502 Bad Gateway:**
- Verificar se Hospital API est√° rodando na porta 8080
- Conferir conectividade entre containers
- Validar configura√ß√£o de rede no docker-compose

### üéØ **Exemplos Pr√°ticos de Uso**

#### **Cen√°rios Hospitalares com Kong**

**1. Login de M√©dico via Kong:**
```bash
# Login direto via Kong Gateway
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "medico@hospital.com",
    "password": "senha123456"
  }'
```

**2. Cria√ß√£o de Consulta com Rate Limiting:**
```bash
# Consulta via Kong (com limita√ß√£o de taxa)
curl -X POST http://localhost:8000/api/v1/consults \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <jwt-token>" \
  -d '{
    "patient": {
      "name": "Jo√£o Silva",
      "email": "joao@email.com"
    },
    "consultDate": "2025-10-14",
    "consultTime": "10:30:00",
    "consultReason": "Consulta de rotina"
  }'
```

**3. Monitoramento de API Hospitalar:**
```bash
# M√©tricas de uso da API
curl http://localhost:8001/metrics

# Status de sa√∫de dos servi√ßos
curl http://localhost:8001/services/hospital-bff/health
```

#### **Configura√ß√£o para Produ√ß√£o**

**Kong com SSL/TLS:**
```yaml
# Configura√ß√£o HTTPS para produ√ß√£o
routes:
- name: auth-secure
  paths: ["/api/v1/auth"]
  protocols: ["https"]
  https_redirect_status_code: 301
```

**Logs Estruturados:**
```yaml
# Plugin de logging para auditoria hospitalar
plugins:
- name: file-log
  config:
    path: "/var/log/kong/hospital-api.log"
    format: "json"
```

## üîß Configura√ß√£o

### Desenvolvimento Local

O perfil `dev` usa as configura√ß√µes em `src/main/resources/application-dev.properties`:

```properties
# Banco local
spring.datasource.url=jdbc:postgresql://localhost:5432/postgres
spring.datasource.username=postgres
spring.datasource.password=postgres
```

### Docker

O perfil padr√£o usa as configura√ß√µes em `src/main/resources/application.properties`:

```properties
# Banco via Docker
spring.datasource.url=jdbc:postgresql://app-db:5432/postgres
spring.datasource.username=postgres
spring.datasource.password=postgres
```

**Nota**: A aplica√ß√£o conecta ao servi√ßo `app-db` definido no `docker-compose.yml`.

## üîë Autentica√ß√£o

A aplica√ß√£o utiliza JWT para autentica√ß√£o. As chaves p√∫blicas e privadas est√£o em:
- `src/main/resources/app.key` (chave privada)
- `src/main/resources/app.pub` (chave p√∫blica)

## üîó Integra√ß√£o GraphQL

O servi√ßo se integra com um backend GraphQL para opera√ß√µes de consulta m√©dica:

### Configura√ß√£o
```properties
# URL do servi√ßo GraphQL (padr√£o)
app.graphql.easyconsult.url=http://localhost:8081/graphql
```

### Funcionalidades GraphQL
- **Queries**: Busca de consultas com filtros
- **Mutations**: Cria√ß√£o, atualiza√ß√£o e exclus√£o de consultas
- **Autentica√ß√£o**: Propaga√ß√£o autom√°tica do JWT token
- **Resili√™ncia**: Tratamento de falhas de conectividade
- **Agrega√ß√£o**: Combina√ß√£o de dados de m√∫ltiplos servi√ßos

## üìñ API Documentation

Ap√≥s iniciar a aplica√ß√£o, a documenta√ß√£o da API estar√° dispon√≠vel em:
- Swagger UI: `http://localhost:8080/swagger-ui.html`

## üêõ Troubleshooting

### Erro de conex√£o com banco (Execu√ß√£o Local)
```
Connection to localhost:5432 refused
```
**Solu√ß√£o**: Certifique-se de que o PostgreSQL est√° rodando:
```bash
docker-compose up app-db -d
```

### Porta j√° est√° em uso
```
Port 8080 was already in use
```
**Solu√ß√£o**: 
- Pare outros processos na porta 8080
- Ou altere a porta em `application.properties`:
```properties
server.port=8081
```

---

## üèóÔ∏è Arquitetura e Melhorias Implementadas

### ‚úÖ **Melhorias Arquiteturais**

1. **Nomenclatura Corrigida:**
   - `ConsultCommandUseCase` ‚Üí `AuthenticationCommandUseCase`
   - `ConsultQueryUseCase` ‚Üí `AuthenticationQueryUseCase`
   - Separa√ß√£o clara entre dom√≠nios de autentica√ß√£o e consultas m√©dicas

2. **Separa√ß√£o de Responsabilidades:**
   - L√≥gica de JWT removida dos gateways e centralizada nos use cases
   - Gateways agora fazem apenas acesso a dados
   - Use cases processam regras de neg√≥cio

3. **Padr√£o de Agrega√ß√£o de Dados:**
   - Implementa√ß√£o de agrega√ß√£o de dados de m√∫ltiplos servi√ßos
   - Chamadas ass√≠ncronas para melhoria de performance
   - Graceful degradation para resili√™ncia

### üîß **Padr√µes RESTful Implementados**

1. **Versionamento da API:**
   ```
   /api/v1/auth/*
   /api/v1/consults/*
   ```

2. **C√≥digos de Status HTTP Corretos:**
   - 201 para cria√ß√£o de recursos
   - 200 para consultas bem-sucedidas
   - 204 para atualiza√ß√µes sem retorno
   - 400 para erros de valida√ß√£o
   - 401 para falhas de autentica√ß√£o
   - 404 para recursos n√£o encontrados
   - 503 para servi√ßos indispon√≠veis

3. **Tratamento de Erros Padronizado:**
   - Global Exception Handler
   - Respostas consistentes para diferentes tipos de erro
   - Logs estruturados

### üìä **Monitoramento e Observabilidade**

1. **Health Checks:**
   - Monitoramento de servi√ßos externos
   - Endpoints Actuator configurados
   - Verifica√ß√£o de conectividade

2. **M√©tricas e Logs:**
   - Logging estruturado com n√≠veis apropriados
   - M√©tricas Prometheus
   - Rastreamento de chamadas externas

### üîí **Seguran√ßa e Valida√ß√£o**

1. **Valida√ß√£o Robusta:**
   - Bean Validation em todos os endpoints
   - Sanitiza√ß√£o de inputs
   - Respostas de erro detalhadas para valida√ß√£o

2. **Criptografia de Senhas:**
   - BCrypt para hash de senhas
   - Implementa√ß√£o segura no use case de comando

## üèóÔ∏è Estrutura da Aplica√ß√£o

```
src/main/java/com/fiap/hospital/bff/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ domain/model/          # Modelos de dom√≠nio
‚îÇ   ‚îú‚îÄ‚îÄ inputport/             # Interfaces de casos de uso
‚îÇ   ‚îú‚îÄ‚îÄ outputport/            # Interfaces de gateways
‚îÇ   ‚îî‚îÄ‚îÄ usecase/               # Implementa√ß√µes dos casos de uso
‚îú‚îÄ‚îÄ infra/
‚îÇ   ‚îú‚îÄ‚îÄ adapter/gateway/       # Implementa√ß√µes dos gateways
‚îÇ   ‚îú‚îÄ‚îÄ config/                # Configura√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ entrypoint/controller/ # Controllers REST
‚îÇ   ‚îú‚îÄ‚îÄ exception/             # Tratamento de exce√ß√µes
‚îÇ   ‚îî‚îÄ‚îÄ service/               # Servi√ßos de agrega√ß√£o
```

## üîó Endpoints da API

### Autentica√ß√£o
- `POST /api/v1/auth/login` - Login de usu√°rio
- `PATCH /api/v1/auth/password` - Atualiza√ß√£o de senha

### Consultas (GraphQL Integration)
- `GET /api/v1/consults` - Listar todas as consultas via GraphQL
- `GET /api/v1/consults/filter` - Buscar consultas com filtros espec√≠ficos
- `POST /api/v1/consults` - Criar nova consulta via GraphQL
- `PUT /api/v1/consults` - Atualizar consulta via GraphQL
- `DELETE /api/v1/consults/{id}` - Excluir consulta via GraphQL

#### GraphQL Endpoints
O servi√ßo se integra com um backend GraphQL externo para opera√ß√µes de consulta:
- **GraphQL URL**: `http://localhost:8081/graphql` (configur√°vel)
- **Autentica√ß√£o**: JWT Bearer Token
- **Opera√ß√µes**: Query, Mutation para CRUD de consultas

### Monitoramento
- `GET /actuator/health` - Status da aplica√ß√£o
- `GET /actuator/metrics` - M√©tricas da aplica√ß√£o

---

## üß™ Estrat√©gia de Testes

### üìã **Vis√£o Geral dos Testes**

Este projeto implementa uma estrat√©gia completa de testes seguindo as melhores pr√°ticas de **TDD (Test-Driven Development)** com foco em cen√°rios hospitalares espec√≠ficos.

### ‚úÖ **Abordagem TDD Implementada**
- **Testes escritos antes da implementa√ß√£o** (quando aplic√°vel)
- **Cobertura de cen√°rios de sucesso e falha**
- **Testes isolados com mocks** para depend√™ncias externas
- **Nomenclatura clara e descritiva** seguindo padr√µes BDD
- **Organiza√ß√£o em classes aninhadas** para melhor legibilidade

### üéØ **Princ√≠pios Seguidos**
- **Isolamento**: Cada teste √© independente e n√£o afeta outros
- **Clareza**: Nomes descritivos explicam o comportamento esperado
- **Organiza√ß√£o**: Testes agrupados por funcionalidade usando `@Nested`
- **Manutenibilidade**: Uso de builders e utilit√°rios para reduzir duplica√ß√£o

### üóÇÔ∏è **Estrutura dos Testes**

#### üìÅ **Testes Unit√°rios**

```
src/test/java/com/fiap/hospital/bff/
‚îú‚îÄ‚îÄ core/usecase/                    # Testes de casos de uso (regras de neg√≥cio)
‚îÇ   ‚îú‚îÄ‚îÄ UserCommandUseCaseImplTest
‚îÇ   ‚îú‚îÄ‚îÄ UserQueryUseCaseImplTest
‚îÇ   ‚îú‚îÄ‚îÄ AuthenticationCommandUseCaseImplTest
‚îÇ   ‚îî‚îÄ‚îÄ AuthenticationQueryUseCaseImplTest
‚îú‚îÄ‚îÄ infra/entrypoint/mapper/         # Testes de mapeamento de dados
‚îÇ   ‚îî‚îÄ‚îÄ UserMapperTest
‚îú‚îÄ‚îÄ infra/adapter/gateway/           # Testes de gateways (acesso a dados)
‚îÇ   ‚îú‚îÄ‚îÄ SaveGatewayImplTest
‚îÇ   ‚îî‚îÄ‚îÄ FindByGatewayImplTest
‚îú‚îÄ‚îÄ infra/adapter/easyconsult/       # Testes de servi√ßos externos
‚îÇ   ‚îî‚îÄ‚îÄ EasyConsultServiceTest
‚îî‚îÄ‚îÄ util/                           # Utilit√°rios para testes
    ‚îî‚îÄ‚îÄ TestDataBuilder
```

#### üìÅ **Testes de Integra√ß√£o**

Os testes de integra√ß√£o foram criados com foco em cen√°rios espec√≠ficos do ambiente hospitalar:

**AuthControllerEnhancedIntegrationTest:**
- ‚úÖ Login por tipos de usu√°rio (PACIENTE, MEDICO, ENFERMEIRO)
- ‚úÖ Seguran√ßa e valida√ß√£o robusta
- ‚úÖ Rota√ß√£o de senhas com valida√ß√£o completa
- ‚úÖ Testes de performance para emerg√™ncias
- ‚úÖ Valida√ß√£o LGPD (dados sens√≠veis protegidos)

**UserControllerAdvancedIntegrationTest:**
- ‚úÖ Listagem para interconsulta (m√©dico busca colegas)
- ‚úÖ Atualiza√ß√£o de dados corporativos
- ‚úÖ Exclus√£o controlada (compliance LGPD)
- ‚úÖ Testes de carga simulando m√∫ltiplos cadastros

### üìä **Cobertura de Testes**

#### üéØ **Use Cases (Casos de Uso)**
- ‚úÖ **UserCommandUseCaseImpl**: Cria√ß√£o, atualiza√ß√£o e exclus√£o de usu√°rios
- ‚úÖ **UserQueryUseCaseImpl**: Consultas de usu√°rios
- ‚úÖ **AuthenticationCommandUseCaseImpl**: Comandos de autentica√ß√£o
- ‚úÖ **AuthenticationQueryUseCaseImpl**: Valida√ß√£o de login e gera√ß√£o de tokens

#### üîÑ **Mappers**
- ‚úÖ **UserMapper**: Convers√µes entre DTOs, Domain Objects e Entities

#### üö™ **Gateways**
- ‚úÖ **SaveGatewayImpl**: Persist√™ncia de usu√°rios
- ‚úÖ **FindByGatewayImpl**: Consultas de usu√°rios

#### üåê **Servi√ßos Externos**
- ‚úÖ **EasyConsultService**: Integra√ß√£o com servi√ßos GraphQL de consulta
  - Cria√ß√£o, consulta, atualiza√ß√£o e exclus√£o de consultas
  - Sele√ß√£o autom√°tica de enfermeiros dispon√≠veis
  - Tratamento de falhas de conectividade
  - Valida√ß√£o de autentica√ß√£o JWT

### üõ†Ô∏è **Ferramentas e Bibliotecas**

```xml
<!-- JUnit 5 -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <scope>test</scope>
</dependency>

<!-- H2 Database para testes -->
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>test</scope>
</dependency>

<!-- Spring Security Test -->
<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-test</artifactId>
    <scope>test</scope>
</dependency>
```

### üè• **Cen√°rios Hospitalares Testados**

#### **üîê Autentica√ß√£o:**
- **M√©dico** fazendo login para plant√£o noturno
- **Enfermeiro** acessando sistema durante troca de turno
- **Paciente** consultando hist√≥rico m√©dico
- **Rota√ß√£o de senhas** por pol√≠tica de seguran√ßa

#### **üë• Gest√£o de Usu√°rios:**
- **Recepcionista** cadastrando paciente rapidamente
- **RH** cadastrando m√©dico rec√©m-contratado
- **Coordena√ß√£o** transferindo enfermeiro de setor
- **M√©dico** buscando especialista para interconsulta

#### **‚ö° Performance e Carga:**
- **M√∫ltiplos cadastros** simult√¢neos (dia de vacina√ß√£o)
- **Login r√°pido** para emerg√™ncias m√©dicas
- **Listagem eficiente** mesmo com muitos usu√°rios

### üöÄ **Executando os Testes**

#### üìã **Comandos Maven**

```bash
# Executar todos os testes (153 testes)
mvn test

# Executar apenas testes unit√°rios
mvn test -Dtest="**/*Test"

# Executar apenas testes de integra√ß√£o
mvn test -Dtest="**/*IntegrationTest"

# Executar testes espec√≠ficos
mvn test -Dtest=EasyConsultServiceTest

# Executar testes com cobertura
mvn test jacoco:report

# Executar testes em modo silencioso
mvn test -q

# Visualizar relat√≥rio de cobertura
# Ap√≥s executar 'mvn test jacoco:report'
# Abrir: target/site/jacoco/index.html
```

#### üìä **Perfis de Teste**
Os testes utilizam o perfil `test` com configura√ß√µes espec√≠ficas:
- Banco H2 em mem√≥ria
- Logs em n√≠vel DEBUG
- URLs de servi√ßos externos mockadas

### üéØ **M√©tricas de Qualidade**

#### ‚úÖ **Resultados Atuais**
- **153 testes implementados** (atualizado em outubro/2025)
- **100% de sucesso** nos testes unit√°rios e de integra√ß√£o
- **0 falhas, 0 erros** na √∫ltima execu√ß√£o
- **Cobertura das principais regras de neg√≥cio**
- **Isolamento completo** com mocks
- **Cen√°rios hospitalares** espec√≠ficos validados
- **Integra√ß√£o GraphQL** totalmente testada

#### üìà **Benef√≠cios Alcan√ßados**
- **Detec√ß√£o precoce de bugs**
- **Refatora√ß√£o segura** com testes de regress√£o
- **Documenta√ß√£o viva** do comportamento esperado
- **Qualidade de c√≥digo** melhorada
- **Compliance LGPD/HIPAA** verificado
- **Performance de emerg√™ncia** testada

### üîç **Principais Funcionalidades Testadas**

#### üë§ **Gest√£o de Usu√°rios**
- ‚úÖ Cadastro de usu√°rios (PACIENTE, MEDICO, ENFERMEIRO)
- ‚úÖ Valida√ß√£o de email √∫nico
- ‚úÖ Criptografia de senhas
- ‚úÖ Consulta e atualiza√ß√£o de dados

#### üîê **Autentica√ß√£o**
- ‚úÖ Login com email/senha
- ‚úÖ Gera√ß√£o de tokens JWT
- ‚úÖ Valida√ß√£o de credenciais
- ‚úÖ Atualiza√ß√£o de senhas

#### üè• **Integra√ß√£o de Consultas**
- ‚úÖ Cria√ß√£o e busca de consultas
- ‚úÖ Agrega√ß√£o de dados de m√∫ltiplos servi√ßos
- ‚úÖ Tratamento de falhas de servi√ßos externos
- ‚úÖ Graceful degradation

---

## üí° **Exemplos de Uso**

### üìã **Resposta de Consulta (GraphQL)**

```json
{
  "id": "1",
  "patient": {
    "name": "Jo√£o Silva",
    "email": "joao.silva@email.com"
  },
  "nameProfessional": "Enfermeira Maria",
  "localTime": "10:30:00",
  "date": "2025-10-14",
  "statusConsult": "AGENDADA",
  "reason": "Consulta de rotina"
}
```

### üîç **Exemplo de Mutation GraphQL**

```graphql
mutation CreateFullConsult($input: ConsultRequestDto!) {
  createFullConsult(input: $input) {
    id
    patient {
      name
      email
    }
    nameProfessional
    localTime
    date
    statusConsult
    reason
  }
}
```

### üìä **Status dos Testes (√öltima Execu√ß√£o)**

```
Tests run: 153, Failures: 0, Errors: 0, Skipped: 0
BUILD SUCCESS
Total time: 40.084 s
```
